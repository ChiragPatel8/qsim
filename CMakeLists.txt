set(CMAKE_CXX_STANDARD 11)
set(OpenMP_INCLUDE_DIR "/Users/bas.nijholt/micromamba/lib/clang/17.0.4/include")
include_directories(${OpenMP_INCLUDE_DIR})
cmake_minimum_required(VERSION 3.11)

# Set APPLE_ARM to TRUE if running on Apple Silicon
if(APPLE)
    execute_process(COMMAND uname -m OUTPUT_VARIABLE OSX_ARCH OUTPUT_STRIP_TRAILING_WHITESPACE)
    if (OSX_ARCH STREQUAL "arm64")
        set(APPLE_ARM TRUE)
    else()  # x86_64
        set(APPLE_ARM FALSE)
    endif()
else()
    set(APPLE_ARM FALSE)
endif(APPLE)

if(APPLE_ARM)
    project(qsim LANGUAGES CXX)
    ADD_SUBDIRECTORY(pybind_interface/basic)
    ADD_SUBDIRECTORY(pybind_interface/decide)
else()
    execute_process(COMMAND which nvcc OUTPUT_VARIABLE has_nvcc)
    if(has_nvcc STREQUAL "")
        execute_process(COMMAND which hipcc OUTPUT_VARIABLE has_hipcc)
        if(has_hipcc STREQUAL "")
            project(qsim LANGUAGES CXX)
        else()
            project(qsim LANGUAGES CXX HIP)
            ADD_SUBDIRECTORY(pybind_interface/hip)
        endif()
    else()
        project(qsim LANGUAGES CXX CUDA)
        ADD_SUBDIRECTORY(pybind_interface/cuda)
        if(DEFINED ENV{CUQUANTUM_ROOT})
            ADD_SUBDIRECTORY(pybind_interface/custatevec)
        endif()
    endif()

    ADD_SUBDIRECTORY(pybind_interface/sse)
    ADD_SUBDIRECTORY(pybind_interface/avx512)
    ADD_SUBDIRECTORY(pybind_interface/avx2)
    ADD_SUBDIRECTORY(pybind_interface/basic)
    ADD_SUBDIRECTORY(pybind_interface/decide)
endif()

if(APPLE)
    find_package(OpenMP REQUIRED)  # Automatically happens for Linux
endif()
